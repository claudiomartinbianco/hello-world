pipeline {
    
    agent any    
    
    stages {
        
        stage("Checkout code") {
            steps {
                git url:'https://github.com/claudiomartinbianco/hello-world.git'
            }
        }        
                     
        
        stage("Config") {
            steps {         
                              
                
                withCredentials([[$class: 'FileBinding', credentialsId: 'mysecret', variable: 'JSON_KEY']]) {
                

                        sh '/var/jenkins_home/google-cloud-sdk/bin/gcloud auth activate-service-account --key-file $JSON_KEY'

                        sh '/var/jenkins_home/google-cloud-sdk/bin/gcloud container clusters get-credentials cluster-1 --zone us-central1-c --project devsecops-287721'

                        // sh '/var/jenkins_home/google-cloud-sdk/bin/kubectl create deployment cmb --image=gcr.io/devsecops-287721/hello-world:latest'



                        sh '/var/jenkins_home/google-cloud-sdk/bin/kubectl create -f deployment.yaml'
        
                }                
                                
            }
        }          
      
           
        
    } 
}
